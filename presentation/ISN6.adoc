:backend: revealjs
:revealjs_theme: moon

= Chapitre V: Langages et programmation II : Python avancé
:source-highlighter: pygments
:pygments-style: tango

//***************************
// Sources d'inspirations: **
//**************************
//
// Article sur les fichiers de wikipedia
//
// https://eric.univ-lyon2.fr/~ricco/cours/slides/PE%20-%20fichiers%20sous%20python.pdf
//
// Nymphomaths:
// http://www.nymphomath.ch/pj/pendu/chapitre7.pdf
//
// Cours Pointal:
// https://perso.limsi.fr/pointal/_media/python:cours:poly_cours_info-algo_sp1-1617-revu.pdf
// https://perso.limsi.fr/pointal/_media/python:cours:tpinfopython_2016-2017_sp1-tp5.pdf


== I. Lecture et écriture dans un fichier

== 1. La notion de fichier

Qu'est ce qu'un fichier ?

=== !

[#ex-fichier]
.Un exemple de fichier
[link=https://en.wikipedia.org/wiki/File:IBM1130CopyCard.agr.jpg]
image::https://upload.wikimedia.org/wikipedia/commons/d/d8/IBM1130CopyCard.agr.jpg[Un fichier]

=== !

Fichier: collection d’informations stockées sur une mémoire morte
(disque dur, clé USB,...)

=== Deux types de fichiers:

* Les fichiers *binaires* qui ne contiennent pas que du texte.
* Les  fichiers *textes* qui ne contiennent que du texte (lettres, ponctuations, nombres, ...).

=== Binaire ou texte ?

[.step]
* .JPEG
* .HTML
* .txt
* .MP3
* .PNG
* .SVG
* .PPM
* .PDF
* .py

== 2. La notion de format

Un exemple, le format .PPM:

[source]
----
P3
# Le # indique les commentaires
# Le P3 signifie que les couleurs sont en ASCII,
 3 2
# par 3 colonnes et 2 lignes,
255
# ayant 255 pour valeur maximum, et qu'elles sont en RGB.
255  0   0     0  255  0       0   0  255
255 255  0    255 255 255      0   0   0
----

Que représente cette image ?

=== !
image::https://upload.wikimedia.org/wikipedia/commons/5/57/Tiny6pixel.png[Résultat]


=== !

Le format de fichier est une convention déterminant l'organisation de l'information
dans le fichier.

=== Métadonnées

Chaque fichier comporte un certain nombre de métadonnées — informations
concernant les informations—

Exemple: longueur du fichier, auteur, date de dernière modification...

=== Attention

Un format tel que le .JPEG contient un grand nombre de métadonnées que
vous ne souhaitez peut être pas partager.

== 3. Accéder à un fichier texte avec Python

Pour accéder à un fichier, on utilise la fonction: `open()`

[source,python]
----
varfichier = open(nom_du_fichier, mode_d_acces, encoding = enco)
----

[.step]
* _nom_du_fichier_: une chaîne qui contient le chemin du fichier
* _mode_d_acces_ :
** Le mode d'accès 'r' pour la lecture (read)
** 'w'  pour l'écriture (write)
** 'a'  pour l'ajout (append)
** ...
* encoding va correspondre à l'encodage, par défaut, _utf-8_

=== !

_varfichier_ fait maintenant référence à objet faisant le lien entre Python
et le fichier.

== 4. Lire dans un fichier

[source,python]
----
# Ouverture d'un fichier en lecture:
f = open("spam.txt", "r")
----

=== !

La lecture d'un fichier *texte* est *séquentielle*.

image::assets/sequentiel.png[sequentiel,width=500,height=350]

=== On peut lire caractère par caractère.

[source,python]
----
# chars est une chaîne contenant les 50 premiers caractères
#du fichier
chars = f.read(50)
# charsbis est une chaîne contenant les deux suivants
charsbis = f.read(2)
----

[source,python]
----
# texte contient tout ce qu'il reste à lire dans le fichier
texte = f.read()
----

=== On peut lire ligne par ligne

[source,python]
----
# ligne contient la ligne suivante
# avec le caractère "\n" à la fin
ligne = f.readline()
----

// [source,python]
// ----
// # lignes contient toutes les lignes restantes sous forme de liste
// lignes = f.readlines()
// ----

=== Python est for

[source,python]
----
#Ces instructions permettent d'afficher le fichier ligne par ligne
for i in f:
  print(i)
----

== 5. Ecrire dans un fichier

Deux modes d'écriture:

=== Le mode "w"

Il va créer le fichier ou l'*écraser* s'il existe déjà.

[source,python]
----
# Ouverture d'un fichier en écriture:
f = open("spam.txt", "w")
----

=== Le mode "a"

Il permet d'ajouter d'écrire à la fin du fichier. (Crée un fichier s'il n'existe pas.)

[source,python]
----
# Ouverture d'un fichier en écriture:
f = open("spam.txt", "a")
----

=== L'écriture est aussi séquentielle

[source,python]
----
# Pour écrire
f.write("hello")
# write n'ajoute pas d'espace ou de saut de ligne
f.write(" world\n")
f.write("!")
----

Le fichier contient maintenant la ligne "hello world". +
Et une ligne: "!"

== 6. Libérer le fichier

Un fichier est une ressource partagée, il faut le libérer après l'avoir
utilisé avec:

[source,python]
----
f.close()
----

=== !

Idéalement, il faudrait gérer les éventuelles erreurs, et faire en sorte
que le fichier se ferme en cas d'erreur.
